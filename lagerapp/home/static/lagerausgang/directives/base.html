<!--<button ng-click="lagerVm.swap_direction()">swap Layout</button>-->
<div flex="40">
    <md-autocomplete ng-disabled="lagerVm.isDisabled" md-no-cache="true" md-delay="600" md-min-length="1"
                     md-selected-item="lagerVm.selectedProject"
                     md-search-text-change="lagerVm.searchTextChange(lagerVm.searchProject)"
                     md-search-text="lagerVm.searchProject"
                     md-selected-item-change="lagerVm.selectedProjectChange(item)"
                     md-items="item in lagerVm.queryProject(lagerVm.searchProject)"
                     md-item-text="item.id+', '+item.description"
                     placeholder="Bitte wählen Sie eine Baustelle aus" md-select-on-match="true">
        <md-item-template>
                <span md-highlight-text="lagerVm.searchProject"
                      md-highlight-flags="^i">{{ item.id+', '+item.description + ', ' +item.manager.firstname
                        + ' ' +item.manager.lastname }}</span>
        </md-item-template>
        <md-not-found>
            Keine Übereinstimmung mit "{{ lagerVm.searchProject }}" gefunden.
        </md-not-found>
    </md-autocomplete>
</div>
<div layout="row">
    <div layout="column" layout-margin flex="50">
        <md-toolbar class="md-hue-3">
            <div class="md-toolbar-tools">
                <span>Lagerausgang eintragen</span>
            </div>
        </md-toolbar>
        <div>
            <p class="input-group" flex="50">
                <input placeholder="Datum" type="text" class="form-control"
                       uib-datepicker-popup="dd.MM.yyyy" ng-model="lagerVm.dt"
                       is-open="lagerVm.popup.opened" datepicker-options="lagerVm.dateOptions"
                       ng-required="true"
                       date-disabled="lagerVm.disabled(date, mode)" current-text="Heute"
                       clear-text="Leeren"
                       close-text="Schließen"/>
                <span class="input-group-btn">
                    <button type="button" class="btn btn-default" ng-click="lagerVm.open_datepicker()">
                        <i class="glyphicon glyphicon-calendar"></i></button>
                </span>
            </p>
        </div>
        <div>
            <md-autocomplete flex="50" md-no-cache="false" md-selected-item="lagerVm.abholer" md-delay="600" md-min-length="1"
                             md-search-text-change=""
                             md-search-text="lagerVm.searchAbholer"
                             md-selected-item-change=""
                             md-items="item in lagerVm.queryStaff(lagerVm.searchAbholer)"
                             md-item-text="item.firstname+' '+item.lastname"
                             placeholder="Bitte wählen Sie einen Mitarbeiter aus.">
                <md-item-template>
                    <span md-highlight-text="lagerVm.searchAbholer"
                          md-highlight-flags="^i">{{ item.firstname +' '+ item.lastname }}
                    </span>
                </md-item-template>
                <md-not-found>
                    Keine Übereinstimmung mit "{{ lagerVm.searchAbholer }}" gefunden.
                </md-not-found>
            </md-autocomplete>
        </div>
        <div layout="row" ng-repeat="row in lagerVm.selectedProducts" layout-align="space-around center">
            <div flex="5">
                <md-button class="md-icon-button" aria-label="Remove Row" ng-click="lagerVm.deleteRow(row.id)">
                    <md-icon md-svg-src="static/img/icons/ic_clear_black_24px.svg"></md-icon>
                </md-button>
            </div>
            <div flex="50">
                <md-autocomplete md-no-cache="false" md-selected-item="row.article" md-delay="600" md-min-length="1"
                                 md-search-text-change="lagerVm.searchTextChange(row.searchProd)"
                                 md-search-text="row.searchProd"
                                 md-selected-item-change="lagerVm.selectedProductChange(row)"
                                 md-items="item in lagerVm.queryStock(row.searchProd)"
                                 md-item-text="item.prodid.id+', '+item.prodid.name1"
                                 placeholder="Bitte wählen Sie einen Artikel aus.">
                    <md-item-template>
                        <span md-highlight-text="row.searchProd"
                              md-highlight-flags="^i">{{ item.prodid.id+', '+item.prodid.name1 }}
                        </span>
                        <md-tooltip md-delay="0" md-autohide="true">{{ item.prodid.id+', '+item.prodid.name1 }}</md-tooltip>
                    </md-item-template>
                    <md-not-found>
                        Keine Übereinstimmung mit "{{ row.searchProd }}" gefunden.
                    </md-not-found>
                </md-autocomplete>
            </div>
            <div flex="15">
                <input type="number" step="0.01" class="form-control" placeholder="Menge" ng-model="row.quantity">
            </div>
            <div flex="15">
                <md-input-container>
                    <label>Einheit</label>
                    <md-select ng-model="row.selectedpacking" >
                        <md-option ng-repeat="packing in row.packings" ng-value="{{ packing }}">
                            {{ packing.name }}
                        </md-option>
                    </md-select>
                </md-input-container>
            </div>
            <div flex="10">
                <i ng-show="row.article && row.quantity && row.selectedpacking" class="material-icons" style="color:darkgreen" ;>check</i>
            </div>
        </div>
        <div>
            <md-button class="md-fab md-mini md-primary" aria-label="Add Row" ng-click="lagerVm.addRow()">
                <md-icon md-svg-src="static/img/icons/ic_add_white_24px.svg"></md-icon>
            </md-button>
        </div>
    </div>
    <md-divider layout-margin></md-divider>
    <div flex="50" layout-margin>
        <md-toolbar layout="row" class="md-hue-3">
            <div class="md-toolbar-tools">
                <span>Vorschau</span>
            </div>
        </md-toolbar>
        <md-content>
            <md-subheader class="md-no-sticky" space-between>
                <div layout="row">
                    <div flex="60">
                        <div>Bauleiter:
                            : {{ lagerVm.selectedProject.manager.firstname }} {{ lagerVm.selectedProject.manager.lastname }}</div>
                        <div>Polier:
                            : {{ lagerVm.selectedProject.leader.firstname }} {{ lagerVm.selectedProject.leader.lastname }}</div>
                        <div>Abholer:
                            : {{ lagerVm.abholer.firstname }} {{ lagerVm.abholer.lastname }}</div>
                        <div>Baustelle : {{ lagerVm.selectedProject.id }} -
                            {{ lagerVm.selectedProject.description | limitTo: 30}}{{ lagerVm.selectedProject.description.length>30 ? '...' : '' }}
                        </div>
                        <div>Lager : {{ lagerVm.stock.name }}</div>
                    </div>
                    <div flex="40">
                        <div>Erfasst:</div>
                        <div>Lagerausgang Nr.:</div>
                        <div>Datum: {{ lagerVm.dt |date:'d. MMM yyyy' }}</div>
                    </div>
                </div>
            </md-subheader>
            <table class="table">
                <thead>
                <th class="col-md-1">Artikelnr.</th>
                <th class="col-md-2">Bezeichnung</th>
                <th class="col-md-1">Menge</th>
                <th class="col-md-1">Einheit</th>
                <th class="col-md-1">Preis</th>
                <th class="col-md-1">Gesamt</th>
                <th class="col-md-1">Verpackung</th>
                </thead>
                <tbody>
                <tr ng-repeat="item in lagerVm.selectedProducts" ng-show="item.article && item.quantity">
                    <td> {{ item.article.prodid.id }}</td>
                    <td> {{ item.article.prodid.name1 }}</td>
                    <td> {{ item.quantity * item.selectedpacking.quantity | number : 3}}</td>
                    <td> {{ item.article.prodid.unit1 }}</td>
                    <td> {{ item.article.prodid.netpurchaseprice |currency:""}} €</td>
                    <td> {{ item.article.prodid.netpurchaseprice * item.quantity | currency:""}} €</td>
                    <td ng-show="item.selectedpacking.quantity!=1">{{ item.selectedpacking.name }}: {{ item.quantity}}  </td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>{{ lagerVm.getTotal() | currency:""}} €</td>
                </tr>
                </tbody>
            </table>
        </md-content>
        <div>
            <md-button class="md-icon-button md-primary" aria-label="Save" ng-click="lagerVm.save()">
                <md-icon md-svg-icon="static/img/icons/ic_save_black_48px.svg"></md-icon>
            </md-button>
            <md-button class="md-raised" ng-click="lagerVm.save()">Speichern</md-button>
        </div>
    </div>
</div>
<h2 ng-show="lagerVm.projectDocs.length!=0">30 Tage Übersicht:</h2>
<div flex="65" ng-repeat="bestellung in lagerVm.projectDocs | orderBy: '-docdate'">
    <div class="panel" ng-class="{'panel-primary': !bestellung.edit, 'panel-edit' : bestellung.edit }">
        <div class="panel-heading">Lagerausgang Nr.: {{ bestellung.id }}
            ({{ bestellung.docdate |date:'d. MMM yyyy' }})
            <li class="btn-group pull-right" uib-dropdown is-open="">
                <a id="single-button" type="button" class="dropdown-toggle" uib-dropdown-toggle
                   ng-disabled="disabled">
                    Optionen <span class="caret"></span>
                </a>
                <ul class="uib-dropdown-menu" aria-labelledby="single-button">
                    <li><a ng-click="lagerVm.delete_doc(bestellung)">Bestellung löschen</a></li>
                    <li><a ng-click="lagerVm.edit_doc(bestellung)">Bestellung bearbeiten</a></li>
                </ul>
            </li>
        </div>
        <div class="panel-body">
            <table class="table">
                <thead>
                <th class="col-md-4">Name</th>
                <th class="col-md-1">Anzahl</th>
                <th class="col-md-1">Einheit</th>
                <th class="col-md-1">Preis</th>
                <th class="col-md-1">Kosten</th>
                <th class="col-md-2">Verpackung</th>
                <th class="col-md-3">Bemerkung</th>
                </thead>
                <tbody>
                <tr class="text-muted" ng-repeat="(key, item) in bestellung.data">
                    <td> {{ item.name }}</td>
                    <td> <span ng-show="bestellung.edit">
                            <input type="number" step="0.01" class="form-control" style="width:100px;"
                                   placeholder="{{ item.quantity }}"
                                   ng-model="item.quantity"></span>
                        <span ng-show="!bestellung.edit">{{ item.quantity }}</span>
                    </td>
                    <td> {{ item.unit }}</td>
                    <td> {{ item.price |currency:""}} €</td>
                    <td> {{ item.quantity*item.price |currency:""}} €</td>
                    <td> {{ item.packing }}</td>
                    <td><span ng-show="bestellung.edit">
                        <textarea type="text" class="form-control" ng-model="item.comment"
                                  placeholder="Bemerkung (optional)" ng-maxlength="255"
                                  maxlength="255"></textarea></span>
                        <span ng-show="!bestellung.edit">{{ item.comment }}</span>
                    </td>
                    <td><span ng-show="bestellung.edit">
                        <li class="btn-group pull-right" uib-dropdown is-open="">
                            <a id="single-button" type="button" class="dropdown-toggle" uib-dropdown-toggle
                               ng-disabled="disabled">
                                Optionen <span class="caret"></span>
                            </a>
                            <ul class="uib-dropdown-menu" aria-labelledby="single-button">
                                <li><a ng-click="lagerVm.delete_docdata(bestellung, item.rowid)">Eintrag
                                    löschen</a></li>
                            </ul>
                        </li></span>
                    </td>
                </tr>
                </tbody>
            </table>

            <div class="well col-md-8 pull-left" ng-hide="bestellung.edit">
                <span ng-show="lagerVm.files[bestellung.id].pdf">
                    <a target="_blank" href="{{ lagerVm.files[bestellung.id].pdf }}">
                        <img ng-src="static/pdficon.png" width="32">Lagerausgang.pdf</a>
                </span>
            </div>


            <div ng-hide="bestellung.edit" class="btn-group col-md-4 pull-right" role="group" aria-label="...">
                <div class="btn-group-vertical" role="group" aria-label="...">
                    <button type="button" class="btn btn-default"
                            ng-click="lagerVm.refresh_documents(bestellung)">
                        <img ng-src="static/pdficon.png" width="24"> erstellen
                    </button>
                </div>
            </div>


            <button ng-show="bestellung.edit" ng-click="lagerVm.save_doc(bestellung)"
                    type="button" class="btn btn-default">Speichern
            </button>
        </div>
    </div>
</div>
<!--<button ng-click="lagerVm.deleteconsumed('10007979')">consumedproduct löschen</button>-->
<!--<pre>{{ lagerVm.show |json }}</pre>-->